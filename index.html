<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AJC Group of Company</title>
    <style>
        /* Global Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: green;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            overflow-x: hidden;
            padding-left: 10px;
            padding-right: 10px;
        }

        header {
            background-color: #333;
            color: #fff;
            padding: 10px 0;
            text-align: center;
            margin: 0;
            box-sizing: border-box;
        }

        nav {
            background-color: #666;
            padding: 10px 0;
            text-align: center;
            margin: 0;
            box-sizing: border-box;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            padding: 0 20px;
            display: inline-block;
        }

        section {
            padding: 20px;
            flex-grow: 1;
            opacity: 0;
            transition: opacity 1s ease-in-out;
            margin: 10px 0;
            box-sizing: border-box;
        }

        footer {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 20px 0;
            margin: 0;
            box-sizing: border-box;
        }

        .order-form, .feedback-form, .about-section {
            max-width: 100%;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }

        .order-form label, .feedback-form label, .about-section h2 {
            display: block;
            margin-bottom: 10px;
        }

        .order-form input[type="text"],
        .order-form input[type="email"],
        .order-form textarea,
        .order-form select,
        .order-form input[type="number"],
        .feedback-form input[type="text"],
        .feedback-form input[type="email"],
        .feedback-form textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .order-form input[type="submit"],
        .feedback-form input[type="submit"] {
            background-color: #4CAF50;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }

        .order-form input[type="submit"]:hover,
        .feedback-form input[type="submit"]:hover {
            background-color: #45a049;
        }

        .order-form .total {
            margin-top: 15px;
            font-weight: bold;
        }

        .product-image {
            max-width: 200px;
            margin-top: 10px;
        }

        .fade-in {
            opacity: 1 !important;
        }

        .price-list {
            background-color: #fff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .price-list h2 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }

        .price-list h3 {
            color: #666;
            margin: 10px 0;
            padding: 5px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .about-section img {
            max-width: 100%;
            height: auto;
            margin: 10px 5px;
            border-radius: 5px;
        }

        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .admin-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .admin-login {
            text-align: center;
        }

        .admin-login input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }

        .admin-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        .admin-btn:hover {
            background-color: #45a049;
        }

        .admin-btn.close {
            background-color: #f44336;
            float: right;
        }

        .admin-btn.close:hover {
            background-color: #d32f2f;
        }

        .admin-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .price-edit {
            margin: 10px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }

        .price-edit label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .price-edit input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .admin-header {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .admin-floating-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #666;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 100;
        }

        .admin-floating-btn:hover {
            background-color: #555;
        }

        .password-change {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e8;
            border-radius: 5px;
        }

        .status-box {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }

        .status-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .status-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .status-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4CAF50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .config-section {
            margin: 15px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        .config-section h4 {
            margin-top: 0;
            color: #333;
        }

        .url-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-family: monospace;
        }

        /* Responsive Design for Mobile Screens */
        @media only screen and (max-width: 600px) {
            body, section, .order-form, .feedback-form {
                width: 100%;
                margin: 0;
                padding: 0;
                padding-left: 10px;
                padding-right: 10px;
            }

            nav a {
                display: block;
                padding: 10px;
                font-size: 14px;
            }

            .order-form, .feedback-form {
                padding: 10px;
            }

            footer {
                position: relative;
            }

            .about-section h2,
            .about-section h3 {
                font-size: 16px;
            }

            .about-section p, .about-section h4 {
                font-size: 14px;
            }

            .product-image {
                max-width: 100%;
                height: auto;
            }

            .order-form input[type="submit"],
            .feedback-form input[type="submit"] {
                width: 100%;
            }

            .order-form input[type="text"],
            .order-form input[type="email"],
            .order-form select,
            .order-form input[type="number"],
            .feedback-form input[type="text"],
            .feedback-form input[type="email"],
            .feedback-form textarea {
                font-size: 16px;
            }

            .about-section img {
                width: 100%;
                height: auto;
                margin: 10px 0;
            }
        }

        @media only screen and (orientation: landscape) and (max-width: 600px) {
            nav a {
                font-size: 16px;
            }

            .order-form, .feedback-form {
                max-width: 95%;
            }

            .order-form input[type="submit"],
            .feedback-form input[type="submit"] {
                width: 100%;
            }
        }
    </style>
    <script>
        function fadeInOnScroll() {
            const sections = document.querySelectorAll("section");
            const windowHeight = window.innerHeight;

            sections.forEach(section => {
                const sectionTop = section.getBoundingClientRect().top;
                if (sectionTop <= windowHeight * 0.8) {
                    section.classList.add("fade-in");
                }
            });
        }

        window.addEventListener("scroll", fadeInOnScroll);
        window.onload = fadeInOnScroll;

        // Configuration - Update these values as needed
        const CONFIG = {
            // Backend API URLs - the system will try these in order
            API_ENDPOINTS: [
                'http://localhost:5000',     // Your local development server
                'http://127.0.0.1:5000',     // Alternative localhost
                'http://192.168.1.100:5000', // Replace with your local IP
                'https://your-backend-domain.com' // Your production domain when ready
            ],
            // Current active endpoint (will be set automatically)
            ACTIVE_API_URL: null
        };

        // EDIT PRICES HERE - Change these values to update prices across all devices
        let prices = {
            "chilly": 10,        // Price per 5g
            "tomato": 5,         // Price per piece
            "spinach": 10,       // Price per piece
            "ladies_finger": 2,  // Price per piece
            "cabbage": 50,       // Price per piece
            "capsicum": 20,      // Price per piece
            "cauliflower": 50    // Price per piece
        };

        // ADMIN PASSWORD - Change this to update admin access
        let adminPassword = 'ajc2025';

        let productImages = {
            "chilly": "static/images/chilly.jpg",
            "tomato": "static/images/tomato.jpg",
            "spinach": "static/images/spinach.jpg",
            "ladies_finger": "static/images/ladies_finger.jpg",
            "cabbage": "static/images/cabbage.jpg",
            "capsicum": "static/images/capsicum.jpg",
            "cauliflower": "static/images/cauliflower.jpg"
        };

        let isAdminLoggedIn = false;

        // Function to find working API endpoint
        async function findWorkingEndpoint() {
            if (CONFIG.ACTIVE_API_URL) {
                return CONFIG.ACTIVE_API_URL;
            }

            for (const endpoint of CONFIG.API_ENDPOINTS) {
                try {
                    const response = await fetch(`${endpoint}/api/health`, {
                        method: 'GET',
                        timeout: 5000 // 5 second timeout
                    });
                    if (response.ok) {
                        CONFIG.ACTIVE_API_URL = endpoint;
                        console.log(`Connected to backend at: ${endpoint}`);
                        return endpoint;
                    }
                } catch (error) {
                    console.log(`Failed to connect to ${endpoint}: ${error.message}`);
                    continue;
                }
            }
            
            throw new Error('No working backend endpoint found');
        }

        function updateProductList() {
            for (let i = 1; i <= 5; i++) {
                const productSelect = document.getElementById("product" + i);
                if (productSelect) {
                    productSelect.innerHTML = '';

                    const defaultOption = document.createElement("option");
                    defaultOption.value = "";
                    defaultOption.text = "Select Product";
                    productSelect.appendChild(defaultOption);

                    for (let item in prices) {
                        const option = document.createElement("option");
                        option.value = item;
                        option.text = item.replace(/_/g, ' ') + " (" + prices[item] + " Rs)";
                        option.setAttribute('data-price', prices[item]);
                        productSelect.appendChild(option);
                    }
                }
            }
        }

        function updateProductImage(i) {
            const product = document.getElementById("product" + i).value;
            const imageElement = document.getElementById("productImage" + i);

            if (product && productImages[product]) {
                imageElement.src = productImages[product];
                imageElement.style.display = 'block';
            } else {
                imageElement.style.display = 'none';
            }
            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            const itemCount = document.getElementById("itemCount").value;
            for (let i = 1; i <= itemCount; i++) {
                const product = document.getElementById("product" + i).value;
                const quantity = parseInt(document.getElementById("quantity" + i).value) || 0;
                if (product && quantity > 0) {
                    total += prices[product] * quantity;
                }
            }
            document.getElementById("totalCost").innerText = "Total Cost: Rs " + total;
        }

        function sendEmail() {
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();

            if (!name || !email) {
                alert("Please fill in all required fields");
                return false;
            }

            let body = "Name: " + name + "%0D%0AEmail: " + email + "%0D%0A%0D%0A";
            const itemCount = document.getElementById("itemCount").value;
            let totalAmount = 0;
            let hasProducts = false;

            for (let i = 1; i <= itemCount; i++) {
                const product = document.getElementById("product" + i).value;
                const quantity = parseInt(document.getElementById("quantity" + i).value) || 0;
                if (product && quantity > 0) {
                    hasProducts = true;
                    const total = prices[product] * quantity;
                    body += "Product " + i + ": " + product.replace(/_/g, ' ') + "%0D%0AQuantity: " + quantity + "%0D%0ATotal Cost: Rs " + total + "%0D%0A%0D%0A";
                    totalAmount += total;
                }
            }

            if (!hasProducts) {
                alert("Please select at least one product with quantity");
                return false;
            }

            body += "Net Amount: Rs " + totalAmount;

            const subject = "Order from " + name;
            const mailtoLink = "mailto:ajcgroupofcompany41@gmail.com?subject=" + encodeURIComponent(subject) + "&body=" + body;
            
            setTimeout(function() {
                window.location.href = mailtoLink;
            }, 100);
            
            return false;
        }

        function sendFeedbackEmail() {
            const name = document.getElementById("feedbackName").value.trim();
            const email = document.getElementById("feedbackEmail").value.trim();
            const feedback = document.getElementById("feedbackMessage").value.trim();
            const senderGmail = document.getElementById("senderGmail").value.trim();

            if (!name || !email || !feedback || !senderGmail) {
                alert("Please fill in all required fields");
                return false;
            }

            let body = "Name: " + name + "%0D%0AEmail: " + email + "%0D%0ASender Gmail: " + senderGmail + "%0D%0A%0D%0AFeedback: " + feedback;

            const subject = "Feedback from " + name;
            const mailtoLink = "mailto:antonyasher71@gmail.com?subject=" + encodeURIComponent(subject) + "&body=" + body;
            
            setTimeout(function() {
                window.location.href = mailtoLink;
            }, 100);
            
            return false;
        }

        function showProductFields() {
            const itemCount = document.getElementById("itemCount").value;
            for (let i = 1; i <= 5; i++) {
                const fieldset = document.getElementById("productFieldset" + i);
                if (fieldset) {
                    fieldset.style.display = i <= itemCount ? 'block' : 'none';
                }
            }
            calculateTotal();
        }

        function updatePriceList() {
            const priceListDiv = document.querySelector('.price-list');
            if (priceListDiv) {
                const productNames = {
                    "chilly": "Chilly",
                    "tomato": "Tomato",
                    "spinach": "Spinach",
                    "ladies_finger": "Ladies finger",
                    "cabbage": "Cabbage",
                    "capsicum": "Capsicum",
                    "cauliflower": "Cauliflower"
                };
                
                let html = '<h2>PRICE LIST AND QUANTITY</h2>';
                for (let item in prices) {
                    if (productNames[item]) {
                        let unit = item === 'chilly' ? '/5g' : '/per piece';
                        html += `<h3>${productNames[item]} = ${prices[item]}rs${unit}</h3>`;
                    }
                }
                priceListDiv.innerHTML = html;
            }
        }

        function showAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            if (!isAdminLoggedIn) {
                showAdminLogin();
            } else {
                showPriceEditor();
            }
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
            isAdminLoggedIn = false;
        }

        function showAdminLogin() {
            const adminContent = document.getElementById('adminContent');
            adminContent.innerHTML = `
                <button class="admin-btn close" onclick="hideAdminPanel()">×</button>
                <div class="admin-login">
                    <h2 class="admin-header">Admin Login</h2>
                    <input type="password" id="adminPasswordInput" placeholder="Enter Admin Password" />
                    <button class="admin-btn" onclick="adminLogin()">Login</button>
                    <p id="loginError" style="color: red; display: none;">Incorrect password!</p>
                </div>
            `;
        }

        function adminLogin() {
            const inputPassword = document.getElementById('adminPasswordInput').value;
            if (inputPassword === adminPassword) {
                isAdminLoggedIn = true;
                showPriceEditor();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function updateBackendUrl() {
            const newUrl = document.getElementById('customApiUrl').value.trim();
            if (newUrl) {
                // Add to the beginning of the endpoints array
                CONFIG.API_ENDPOINTS.unshift(newUrl);
                // Reset active URL to force re-detection
                CONFIG.ACTIVE_API_URL = null;
                
                document.getElementById('urlUpdateStatus').innerHTML = 
                    '<div class="status-box status-success">✅ URL updated! Test the connection to verify it works.</div>';
            }
        }

        function showPriceEditor() {
            const adminContent = document.getElementById('adminContent');
            let html = `
                <button class="admin-btn close" onclick="hideAdminPanel()">×</button>
                <h2 class="admin-header">Price Management</h2>
            `;
            
            const productNames = {
                "chilly": "Chilly (Rs/5g)",
                "tomato": "Tomato (Rs/per piece)",
                "spinach": "Spinach (Rs/per piece)",
                "ladies_finger": "Ladies finger (Rs/per piece)",
                "cabbage": "Cabbage (Rs/per piece)",
                "capsicum": "Capsicum (Rs/per piece)",
                "cauliflower": "Cauliflower (Rs/per piece)"
            };

            for (let item in prices) {
                html += `
                    <div class="price-edit">
                        <label>${productNames[item]}:</label>
                        <input type="number" id="price_${item}" value="${prices[item]}" min="0" step="0.01" />
                    </div>
                `;
            }

            html += `
                <div class="config-section">
                    <h4>🔧 Backend Configuration</h4>
                    <p style="font-size: 12px; margin: 5px 0;">Current backend URLs (trying in this order):</p>
                    <ul style="font-size: 11px; margin: 5px 0; padding-left: 20px;">
                        ${CONFIG.API_ENDPOINTS.map(url => `<li><code>${url}</code></li>`).join('')}
                    </ul>
                    <input type="url" id="customApiUrl" class="url-input" placeholder="http://localhost:5000 or http://your-ip:5000" />
                    <button class="admin-btn" onclick="updateBackendUrl()" style="padding: 5px 10px; font-size: 12px;">Add Custom URL</button>
                    <div id="urlUpdateStatus"></div>
                    
                    <button class="admin-btn" onclick="testBackendConnection()" style="padding: 5px 10px; font-size: 12px; margin-top: 10px;">🔗 Test Connection</button>
                    <div id="connectionStatus"></div>
                </div>

                <label for="adminSecret" style="display: block; margin-top: 15px; font-weight: bold;">Admin Secret Key:</label>
                <input type="password" id="adminSecret" placeholder="Enter admin secret for GitHub updates" style="width: 100%; padding: 8px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;" />
                
                <button class="admin-btn" id="savePricesBtn" onclick="savePrices()">Update Prices & Push to GitHub</button>
                <div id="updateStatus" style="margin-top: 15px;"></div>

                <div class="password-change">
                    <h3>Change Admin Password</h3>
                    <input type="password" id="currentPassword" placeholder="Current Password" />
                    <input type="password" id="newPassword" placeholder="New Password" />
                    <input type="password" id="confirmPassword" placeholder="Confirm New Password" />
                    <button class="admin-btn" onclick="changePassword()">Change Password</button>
                    <p id="passwordError" style="color: red; display: none;"></p>
                    <p id="passwordSuccess" style="color: green; display: none;"></p>
                </div>
            `;

            adminContent.innerHTML = html;
        }

        async function testBackendConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.innerHTML = '<div class="loading-spinner"></div>Testing connections...';
            
            try {
                const workingEndpoint = await findWorkingEndpoint();
                statusDiv.innerHTML = `<div class="status-box status-success">✅ Backend connected successfully!<br><small>Active endpoint: <code>${workingEndpoint}</code></small></div>`;
            } catch (error) {
                statusDiv.innerHTML = `
                    <div class="status-box status-error">
                        ❌ All backend connections failed!<br>
                        <small>Make sure your backend server is running on port 5000</small><br>
                        <details style="margin-top: 10px;">
                            <summary style="cursor: pointer;">🔧 Troubleshooting Tips</summary>
                            <ul style="font-size: 12px; margin: 5px 0; text-align: left;">
                                <li>Start your backend server: <code>python app.py</code> or <code>node server.js</code></li>
                                <li>Check if port 5000 is free: <code>netstat -an | grep 5000</code></li>
                                <li>Try accessing <a href="http://localhost:5000/api/health" target="_blank">http://localhost:5000/api/health</a> in your browser</li>
                                <li>If using a different port, add it using "Add Custom URL" above</li>
                                <li>Check firewall settings if accessing from another device</li>
                            </ul>
                        </details>
                    </div>
                `;
            }
        }

        async function savePrices() {
            const adminSecret = document.getElementById('adminSecret').value.trim();
            const savePricesBtn = document.getElementById('savePricesBtn');
            const statusDiv = document.getElementById('updateStatus');

            if (!adminSecret) {
                statusDiv.innerHTML = '<div class="status-box status-error">Please enter the admin secret key.</div>';
                return;
            }

            // Update prices in memory first
            for (let item in prices) {
                const newPrice = parseFloat(document.getElementById(`price_${item}`).value);
                if (!isNaN(newPrice) && newPrice >= 0) {
                    prices[item] = newPrice;
                }
            }

            // Update local displays immediately
            updateProductList();
            updatePriceList();
            calculateTotal();

            // Disable button and show loading
            savePricesBtn.disabled = true;
            savePricesBtn.innerHTML = '<div class="loading-spinner"></div>Updating GitHub...';
            statusDiv.innerHTML = '<div class="status-box status-info"><div class="loading-spinner"></div>Connecting to backend server...</div>';

            try {
                const workingEndpoint = await findWorkingEndpoint();
                
                statusDiv.innerHTML = '<div class="status-box status-info"><div class="loading-spinner"></div>Updating prices in GitHub repository...</div>';

                const response = await fetch(`${workingEndpoint}/api/update-prices`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        prices: prices,
                        adminSecret: adminSecret
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    statusDiv.innerHTML = `
                        <div class="status-box status-success">
                            ✅ Success! Prices updated in GitHub repository.
                            <br>
                            <small>Changes will be live on all devices within a few minutes.</small>
                            ${result.commit ? `<br><a href="${result.commit}" target="_blank">View Commit</a>` : ''}
                        </div>
                    `;
                } else {
                    statusDiv.innerHTML = `
                        <div class="status-box status-error">
                            ❌ Failed to update GitHub: ${result.error}
                            <br>
                            <small>${result.details || 'Please check your admin secret and try again.'}</small>
                        </div>
                    `;
                }

            } catch (error) {
                console.error('Error updating prices:', error);
                statusDiv.innerHTML = `
                    <div class="status-box status-error">
                        ❌ Connection error: ${error.message}
